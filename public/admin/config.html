<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuración - Asistente IA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .config-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .card {
            margin-bottom: 20px;
        }
        .alert {
            display: none;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="config-container">
        <h1 class="mb-4">Configuración del Asistente IA</h1>
        
        <!-- Configuración General -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Configuración General</h5>
            </div>
            <div class="card-body">
                <form id="generalConfig">
                    <div class="form-group">
                        <label for="apiKey">API Key</label>
                        <input type="text" class="form-control" id="apiKey" required>
                        <small class="form-text text-muted">Tu clave de API para el Asistente IA</small>
                    </div>
                    <div class="form-group">
                        <label for="theme">Tema del Chat</label>
                        <select class="form-control" id="theme">
                            <option value="light">Claro</option>
                            <option value="dark">Oscuro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="position">Posición del Chat</label>
                        <select class="form-control" id="position">
                            <option value="bottom-right">Abajo derecha</option>
                            <option value="bottom-left">Abajo izquierda</option>
                        </select>
                    </div>
                </form>
            </div>
        </div>

        <!-- Configuración de Mensajes -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Mensajes Personalizados</h5>
            </div>
            <div class="card-body">
                <form id="messagesConfig">
                    <div class="form-group">
                        <label for="welcomeMessage">Mensaje de Bienvenida</label>
                        <textarea class="form-control" id="welcomeMessage" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="offlineMessage">Mensaje Fuera de Horario</label>
                        <textarea class="form-control" id="offlineMessage" rows="2"></textarea>
                    </div>
                </form>
            </div>
        </div>

        <!-- Configuración de Horarios -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Horarios de Atención</h5>
            </div>
            <div class="card-body">
                <form id="scheduleConfig">
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="24hours">
                        <label class="form-check-label" for="24hours">Atención 24 horas</label>
                    </div>
                    <div id="scheduleFields">
                        <div class="row">
                            <div class="col-md-6">
                                <label>Hora de inicio</label>
                                <input type="time" class="form-control" id="startTime">
                            </div>
                            <div class="col-md-6">
                                <label>Hora de fin</label>
                                <input type="time" class="form-control" id="endTime">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Configuración de Productos -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Configuración de Productos</h5>
            </div>
            <div class="card-body">
                <form id="productsConfig">
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="showPrices">
                        <label class="form-check-label" for="showPrices">Mostrar precios</label>
                    </div>
                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="showStock">
                        <label class="form-check-label" for="showStock">Mostrar stock</label>
                    </div>
                    <div class="form-group">
                        <label for="maxProducts">Máximo de productos a mostrar</label>
                        <input type="number" class="form-control" id="maxProducts" min="1" max="10">
                    </div>
                </form>
            </div>
        </div>

        <button type="button" class="btn btn-primary" onclick="saveConfig()">Guardar Configuración</button>
        
        <div class="alert alert-success" id="successAlert">
            Configuración guardada exitosamente
        </div>
        <div class="alert alert-danger" id="errorAlert">
            Error al guardar la configuración
        </div>
    </div>

    <script>
        // Cargar configuración actual
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                // Configuración general
                document.getElementById('apiKey').value = config.apiKey || '';
                document.getElementById('theme').value = config.theme || 'light';
                document.getElementById('position').value = config.position || 'bottom-right';
                
                // Mensajes
                document.getElementById('welcomeMessage').value = config.welcomeMessage || '¡Hola! Soy el Asistente IA. ¿En qué puedo ayudarte hoy?';
                document.getElementById('offlineMessage').value = config.offlineMessage || 'En este momento estamos fuera de horario. Volveremos pronto.';
                
                // Horarios
                document.getElementById('24hours').checked = config.is24Hours || false;
                document.getElementById('startTime').value = config.startTime || '09:00';
                document.getElementById('endTime').value = config.endTime || '18:00';
                
                // Productos
                document.getElementById('showPrices').checked = config.showPrices !== false;
                document.getElementById('showStock').checked = config.showStock !== false;
                document.getElementById('maxProducts').value = config.maxProducts || 5;
                
                toggleScheduleFields();
            } catch (error) {
                console.error('Error al cargar la configuración:', error);
                showAlert('error');
            }
        }

        // Guardar configuración
        async function saveConfig() {
            try {
                const config = {
                    apiKey: document.getElementById('apiKey').value,
                    theme: document.getElementById('theme').value,
                    position: document.getElementById('position').value,
                    welcomeMessage: document.getElementById('welcomeMessage').value,
                    offlineMessage: document.getElementById('offlineMessage').value,
                    is24Hours: document.getElementById('24hours').checked,
                    startTime: document.getElementById('startTime').value,
                    endTime: document.getElementById('endTime').value,
                    showPrices: document.getElementById('showPrices').checked,
                    showStock: document.getElementById('showStock').checked,
                    maxProducts: parseInt(document.getElementById('maxProducts').value)
                };

                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    showAlert('success');
                } else {
                    throw new Error('Error al guardar');
                }
            } catch (error) {
                console.error('Error al guardar la configuración:', error);
                showAlert('error');
            }
        }

        // Mostrar/ocultar alertas
        function showAlert(type) {
            const successAlert = document.getElementById('successAlert');
            const errorAlert = document.getElementById('errorAlert');
            
            if (type === 'success') {
                successAlert.style.display = 'block';
                setTimeout(() => successAlert.style.display = 'none', 3000);
            } else {
                errorAlert.style.display = 'block';
                setTimeout(() => errorAlert.style.display = 'none', 3000);
            }
        }

        // Toggle campos de horario
        function toggleScheduleFields() {
            const is24Hours = document.getElementById('24hours').checked;
            const scheduleFields = document.getElementById('scheduleFields');
            scheduleFields.style.display = is24Hours ? 'none' : 'block';
        }

        // Event listeners
        document.getElementById('24hours').addEventListener('change', toggleScheduleFields);

        // Cargar configuración al iniciar
        loadConfig();
    </script>
</body>
</html> 